{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"@auth0/auth0-angular\";\nimport * as i3 from \"ngx-cookie-service\";\nexport class AuthInterceptor {\n  constructor(appStore, auth, cookieService) {\n    this.appStore = appStore;\n    this.auth = auth;\n    this.cookieService = cookieService;\n    this.token = '';\n    this.getToken();\n  }\n  intercept(req, next) {\n    const token = this.cookieService.get('userToken');\n    const authReq = req.clone({\n      headers: new HttpHeaders({\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      })\n    });\n    return next.handle(authReq).pipe(tap({\n      error: error => {\n        if (error.status === 403 || error.status === 401) {\n          this.auth.logout({\n            logoutParams: {\n              returnTo: document.location.origin\n            }\n          });\n        }\n      }\n    }));\n  }\n  getToken() {\n    this.appStore.select('app').subscribe(state => {\n      this.token = state.token;\n    });\n  }\n  static #_ = this.ɵfac = function AuthInterceptor_Factory(t) {\n    return new (t || AuthInterceptor)(i0.ɵɵinject(i1.Store), i0.ɵɵinject(i2.AuthService), i0.ɵɵinject(i3.CookieService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthInterceptor,\n    factory: AuthInterceptor.ɵfac\n  });\n}","map":{"version":3,"names":["HttpHeaders","tap","AuthInterceptor","constructor","appStore","auth","cookieService","token","getToken","intercept","req","next","get","authReq","clone","headers","handle","pipe","error","status","logout","logoutParams","returnTo","document","location","origin","select","subscribe","state","_","i0","ɵɵinject","i1","Store","i2","AuthService","i3","CookieService","_2","factory","ɵfac"],"sources":["C:\\Users\\HP\\Desktop\\GOP\\RGO-Client\\Frontend\\RGO-Frontend\\src\\app\\interceptor\\auth0.interceptor.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpInterceptor, HttpHandler, HttpRequest, HttpHeaders } from '@angular/common/http';\r\nimport { Store } from '@ngrx/store';\r\nimport { Token } from '../models/token.interface';\r\nimport { AuthService } from '@auth0/auth0-angular';\r\nimport { tap } from 'rxjs/operators';\r\nimport { CookieService } from 'ngx-cookie-service';\r\n\r\n@Injectable()\r\nexport class AuthInterceptor implements HttpInterceptor {\r\n  token: string = '';\r\n\r\n  constructor(private appStore: Store<{ app: Token }>, private auth: AuthService, private cookieService: CookieService) {\r\n    this.getToken();\r\n  }\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler) {\r\n    const token = this.cookieService.get('userToken');\r\n    const authReq = req.clone({\r\n      headers: new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json'\r\n      })\r\n    });\r\n\r\n    return next.handle(authReq).pipe(\r\n      tap({\r\n        error: (error: any) => {\r\n          if (error.status === 403 || error.status === 401) {\r\n            this.auth.logout({\r\n              logoutParams: { returnTo: document.location.origin },\r\n            });\r\n          }\r\n        },\r\n      })\r\n    );\r\n  }\r\n\r\n  getToken() {\r\n    this.appStore.select('app').subscribe(state => {\r\n      this.token = state.token;\r\n    });\r\n  }\r\n}\r\n\r\n"],"mappings":"AACA,SAAoDA,WAAW,QAAQ,sBAAsB;AAI7F,SAASC,GAAG,QAAQ,gBAAgB;;;;;AAIpC,OAAM,MAAOC,eAAe;EAG1BC,YAAoBC,QAA+B,EAAUC,IAAiB,EAAUC,aAA4B;IAAhG,KAAAF,QAAQ,GAARA,QAAQ;IAAiC,KAAAC,IAAI,GAAJA,IAAI;IAAuB,KAAAC,aAAa,GAAbA,aAAa;IAFrG,KAAAC,KAAK,GAAW,EAAE;IAGhB,IAAI,CAACC,QAAQ,EAAE;EACjB;EAEAC,SAASA,CAACC,GAAqB,EAAEC,IAAiB;IAChD,MAAMJ,KAAK,GAAG,IAAI,CAACD,aAAa,CAACM,GAAG,CAAC,WAAW,CAAC;IACjD,MAAMC,OAAO,GAAGH,GAAG,CAACI,KAAK,CAAC;MACxBC,OAAO,EAAE,IAAIf,WAAW,CAAC;QACvB,eAAe,EAAE,UAAUO,KAAK,EAAE;QAClC,cAAc,EAAE;OACjB;KACF,CAAC;IAEF,OAAOI,IAAI,CAACK,MAAM,CAACH,OAAO,CAAC,CAACI,IAAI,CAC9BhB,GAAG,CAAC;MACFiB,KAAK,EAAGA,KAAU,IAAI;QACpB,IAAIA,KAAK,CAACC,MAAM,KAAK,GAAG,IAAID,KAAK,CAACC,MAAM,KAAK,GAAG,EAAE;UAChD,IAAI,CAACd,IAAI,CAACe,MAAM,CAAC;YACfC,YAAY,EAAE;cAAEC,QAAQ,EAAEC,QAAQ,CAACC,QAAQ,CAACC;YAAM;WACnD,CAAC;;MAEN;KACD,CAAC,CACH;EACH;EAEAjB,QAAQA,CAAA;IACN,IAAI,CAACJ,QAAQ,CAACsB,MAAM,CAAC,KAAK,CAAC,CAACC,SAAS,CAACC,KAAK,IAAG;MAC5C,IAAI,CAACrB,KAAK,GAAGqB,KAAK,CAACrB,KAAK;IAC1B,CAAC,CAAC;EACJ;EAAC,QAAAsB,CAAA,G;qBAjCU3B,eAAe,EAAA4B,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,KAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,WAAA,GAAAL,EAAA,CAAAC,QAAA,CAAAK,EAAA,CAAAC,aAAA;EAAA;EAAA,QAAAC,EAAA,G;WAAfpC,eAAe;IAAAqC,OAAA,EAAfrC,eAAe,CAAAsC;EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}