<app-confirm-dialog *ngIf="showConfirmDialog" [dialogType]="dialogTypeData" (confirmation)="dialogFeedBack($event)"></app-confirm-dialog>
<div class="row">
  <div class="col-12 mt-3" id="button-save-container">
    <button mat-button id="savechangesbtn" (click)="openDialog()" class="btn btn-primary rounded-pill">Save Changes</button>
  </div>
  <ngx-skeleton-loader *ngIf="isLoading" [count]="1" appearance="line" animation="pulse" [theme]="{
    'background-color': '#D7DFFF',
    'border': '2px solid #D7DFFF',
    'border-radius': '10px',
    'height': '80vh',
    width: '100%',
  }"/>
  <table *ngIf="!isLoading">
    <thead id="tableheader">
      <th id="table-header" class="px-3">Permissions</th>
      <th *ngFor="let p of roles" id="table-header" class="px-3">
        {{ p.description }}
      </th>
    </thead>
    <tbody>
      <tr>
        <th class="py-2 px-3" scope="row" id="subheader">
          Charts
        </th>
        <th class="py-2 px-3" scope="row" *ngFor="let r of roles" id="allsubheader">
          <mat-checkbox [(ngModel)]="allCheckboxesState[r.description]"
            (change)="toggleAllCheckboxes(r.description, $event)">
            <label class="ps-3">All</label>
          </mat-checkbox>
        </th>
      </tr>
      <tr *ngFor="let n of chartPermissions">
        <th class="py-2 px-3" scope="row" id="permissions">
          {{ n.permission }}
        </th>
        <td class="py-2 px-3" *ngFor="let r of roles">
          <mat-checkbox [(ngModel)]="checkboxStates[r.description + n.permission]"
            (change)="onChangeRoleAccess($event, r.description, n.permission, n.grouping)">
          </mat-checkbox>
        </td>
      </tr>
      <tr>
        <th class="py-2 px-3" scope="row" id="subheader">
          Employee Data
        </th>
        <th class="py-2 px-3" scope="row" *ngFor="let r of roles" id="allsubheader">
          <mat-checkbox [(ngModel)]="allEmployeeDataCheckboxesState[r.description]"
            (change)="toggleAllEmployeeDataCheckboxes(r.description, $event)">
            <label class="ps-3">All</label>
          </mat-checkbox>
        </th>
      </tr>
      <tr *ngFor="let n of employeePermissions">
        <th class="py-2 px-3" scope="row" id="permissions">
          {{n.permission}}
        </th>
        <td class="py-2 px-3" *ngFor="let r of roles">
          <mat-checkbox [(ngModel)]="checkboxStatesEmployeePermissions[r.description + n.permission]"
            (change)="onChangeRoleAccess($event, r.description, n.permission, n.grouping)">
          </mat-checkbox>
        </td>
      </tr>
    </tbody>
  </table>
</div>
