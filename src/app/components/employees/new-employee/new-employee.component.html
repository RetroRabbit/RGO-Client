<div class="container">
    <mat-stepper class="rounded-4 mt-4" [linear]="isLinear" #stepper>
      <mat-step [stepControl]="newEmployeeForm" label="Basic Information">
        <ng-template matStepLabel>Basic Information</ng-template>
        <div class="row justify-content-center align-items-center">
          <div class="col-md-12 col-lg-12">
            <h2 class="text-center" id="createEmployee">Create employee profile</h2>
            <span class="text-center roboto-font" id="heading-text">
              <p>Please enter the employeeâ€™s information in</p>
                <p>order to create a profile for them.</p>
            </span>
          </div>
        </div>
        <form [formGroup]="newEmployeeForm" (ngSubmit)="onSubmit(false)" id="newEmployeeForm">
            <div class="row justify-content-center align-items-center">
                <div class="row justify-content-center align-items-center roboto-font col-md-12 pb-3">
                  <h1 class="col-lg-7 col-md-12" id="heading">Employee Details</h1>
                  <p class="col-lg-7 col-md-12">Note: *The asterisk indicates required fields</p>
                </div>
                <div class="row flex-column justify-content-center align-items-center col-md-12">
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Full name</mat-label>
                    <input matInput type="text" formControlName="name" />
                    <mat-error *ngIf="newEmployeeForm.controls['name'].hasError('required')"> Full name is required</mat-error>
                    <mat-error *ngIf="newEmployeeForm.controls['name'].hasError('pattern') && !newEmployeeForm.controls['name'].hasError('required') " >
                      Full name must not contain numbers</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Last name</mat-label>
                    <input matInput type="text" formControlName="surname" />
                    <mat-error *ngIf="newEmployeeForm.controls['surname'].hasError('required')"> Last name is required</mat-error>
                    <mat-error *ngIf="newEmployeeForm.controls['surname'].hasError('pattern') && !newEmployeeForm.controls['surname'].hasError('required') " >
                      Last name must not contain numbers</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Initials</mat-label>
                    <input matInput type="text" formControlName="initials" />
                    <mat-error *ngIf="newEmployeeForm.controls['initials'].hasError('required')"> Initials are required</mat-error>
                    <mat-error *ngIf="newEmployeeForm.controls['initials'].hasError('pattern') && !newEmployeeForm.controls['initials'].hasError('required')">
                      Initials must not contain numbers</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Work Email</mat-label>
                    <input matInput type="email" formControlName="email" />
                    <mat-error *ngIf="newEmployeeForm.controls['email'].hasError('required')"> Work email is required</mat-error>
                    <mat-error *ngIf="newEmployeeForm.controls['email'].hasError('pattern') && !newEmployeeForm.controls['email'].hasError('required')">
                       Work email must end with @retrorabbit.co.za</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Personal Email</mat-label>
                    <input matInput type="email" formControlName="personalEmail" />
                    <mat-error *ngIf="newEmployeeForm.controls['personalEmail'].hasError('required')"> Personal email is required</mat-error>
                    <mat-error *ngIf="newEmployeeForm.controls['personalEmail'].hasError('pattern') && !newEmployeeForm.controls['personalEmail'].hasError('required')">
                      This is not a valid email</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Role</mat-label>
                    <mat-select formControlName="employeeType">
                      <mat-option *ngFor="let type of employeeTypes" [value]="type">{{ type.name }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                      <mat-label>People's Champion</mat-label>
                      <input type="text" placeholder="" matInput
                          formControlName="peopleChampion" [matAutocomplete]="autoChampion"
                          (input)="filterChampions($event)">
                      <mat-autocomplete #autoChampion="matAutocomplete">
                          <mat-option *ngFor="let peopleChampion of filteredPeopleChamps"
                              [value]="peopleChampion.name + ' ' + peopleChampion.surname"
                              (onSelectionChange)="getId(peopleChampion, 'champion')">
                              {{ peopleChampion.name }}
                              {{ peopleChampion.surname }}</mat-option>
                      </mat-autocomplete>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Select level</mat-label>
                    <mat-select formControlName="level">
                      <mat-option *ngFor="let level of levels" [value]="level">{{ level }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Start Date</mat-label>
                    <input matInput formControlName="engagementDate" [matDatepicker]="engagementDatePicker" />
                    <mat-datepicker-toggle matSuffix [for]="engagementDatePicker"></mat-datepicker-toggle>
                    <mat-datepicker #engagementDatePicker></mat-datepicker>
                    <mat-error *ngIf="newEmployeeForm.controls['engagementDate'].hasError('required')">Engagement date is required</mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>ID number</mat-label>
                    <input matInput type="text" formControlName="idNumber" (blur)="getGenderBirthday($event)"/>
                    <mat-error *ngIf="newEmployeeForm.controls['idNumber'].hasError('invalidIdNumber') && !newEmployeeForm.controls['idNumber'].hasError('required')">
                      Not a valid South African ID number
                    </mat-error>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="col-md-12 col-lg-7">
                    <mat-label>Date of Birth</mat-label>
                    <input matInput formControlName="dateOfBirth" [matDatepicker]="dateOfBirthPicker" />
                    <mat-datepicker-toggle matSuffix [for]="dateOfBirthPicker"></mat-datepicker-toggle>
                    <mat-datepicker #dateOfBirthPicker></mat-datepicker>
                    <mat-error *ngIf="newEmployeeForm.controls['dateOfBirth'].hasError('required')"> Date of birth is required</mat-error>
                  </mat-form-field>
                </div>
                <form [formGroup]="settingsForm"
                  class="row flex-column justify-content-center align-items-center roboto-font col-md-12 pb-5">
                  <div class="col-lg-7"> <label class="fw-base pe-3" id="additional-fields-label"
                      for="additionalFieldsToggle">Additional fields</label>
                    <mat-slide-toggle color="primary" id="additionalFieldsToggle"
                      formControlName="toggleAdditionalFields"></mat-slide-toggle>
                  </div>
                </form>
                <div *ngIf="settingsForm.controls['toggleAdditionalFields'].value === true "
                  class="row justify-content-center align-items-center col-md-12">
                  <div class="row flex-column justify-content-center align-items-center roboto-font pb-5">
                    <h1 class="col-lg-7 col-md-12 pb-3" id="heading">Additional Information</h1>
                    <div class="col-lg-7 col-md-12 pb-3">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Profile photo</mat-label>
                        <input matInput type="text" [value]="imageName" />
                        <span mat-icon-button matSuffix (click)="uploadFile.click()" class="pe-3">
                          <mat-icon id="fileUploadCursor">file_upload</mat-icon>
                          <input type="file" #uploadFile (change)="onFileChange($event)" hidden />
                        </span>
                      </mat-form-field>
                      <div id="image-preview" *ngIf="imageUrl !== ''">
                        <img [src]="imageUrl"/>
                      </div>
                    </div>
                    <div class="row flex-column justify-content-center align-items-center col-lg-12 col-md-12 pb-3">
                      <span class="col-lg-7 fs-5 roboto-font pb-3">Gender</span>
                      <mat-radio-group class="col-lg-7" formControlName="gender">
                        <mat-radio-button *ngFor="let gender of genders; index as i" [value]="i">{{ gender }}</mat-radio-button>
                      </mat-radio-group>
                    </div>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12">
                      <mat-label>Select race</mat-label>
                      <mat-select formControlName="race">
                        <mat-option *ngFor="let race of races; index as i" [value]="i">{{ race }}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <mat-form-field *ngIf="newEmployeeForm.controls['idNumber'].value === ''" appearance="outline" class="col-lg-7 col-md-12">
                      <mat-label>Passport number</mat-label>
                      <input matInput type="number" formControlName="passportNumber" />
                    </mat-form-field>
                    <mat-form-field *ngIf="newEmployeeForm.controls['idNumber'].value === ''" appearance="outline" class="col-lg-7 col-md-12">
                      <mat-label>Passport expiration date</mat-label>
                      <input matInput formControlName="passportExpiryDate" [matDatepicker]="passportExpiryDate" />
                      <mat-datepicker-toggle matSuffix [for]="passportExpiryDate"></mat-datepicker-toggle>
                      <mat-datepicker #passportExpiryDate></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field *ngIf="newEmployeeForm.controls['idNumber'].value === ''" appearance="outline" class="col-lg-7 col-md-12 custom-mat-select">
                      <mat-label>Country of issue</mat-label>
                      <input matInput type="text" formControlName="passportCountryIssue" />
                      <mat-select #countrySelect formControlName="passportCountryIssue" hidden>
                        <mat-option *ngFor="let country of countries" [value]="country">{{ country }}</mat-option>
                      </mat-select>
                      <mat-icon matSuffix (click)="countrySelect.open()">search</mat-icon>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12" *ngIf="!postalAddressForm.controls['sameAsPhysicalAddress'].value">
                      <mat-label>Notes</mat-label> <textarea matInput type="text" formControlName="notes">
                      </textarea>
                    </mat-form-field>
                    <div class="col-lg-7 col-md-12"> <span class="roboto-font pb-3">Do you have any disabilities ?</span>
                      <mat-radio-group formControlName="disability">
                        <mat-radio-button *ngFor="let check of [true, false]" [value]="check">{{ check ? "Yes" : "No"
                          }}</mat-radio-button>
                      </mat-radio-group>
                    </div>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12"
                      *ngIf="newEmployeeForm.controls['disability'].value">
                      <mat-label>Diability notes</mat-label> <textarea matInput type="text"
                        formControlName="disabilityNotes">
                      </textarea>
                    </mat-form-field>
                  </div>
                  <form [formGroup]="physicalAddress" class="row flex-column justify-content-center align-items-center roboto-font col-md-12 mb-3">
                    <h1 class="col-lg-7 col-md-12 fs-1">Physical Address</h1>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Unit Number</mat-label>
                      <input matInput type="text" formControlName="unitNumber" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Complex Name</mat-label>
                      <input matInput type="text" formControlName="complexName" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>City/Town</mat-label>
                      <input matInput type="text" formControlName="city" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Suburb/District</mat-label>
                      <input matInput type="text" formControlName="suburbDistrict" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Street Number</mat-label>
                      <input matInput type="text" formControlName="streetNumber" />
                      <mat-error *ngIf="physicalAddress.controls['streetNumber'].hasError('pattern')">
                        Street number must  only contain numbers
                      </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Country</mat-label>
                      <mat-select formControlName="country">
                        <mat-option *ngFor="let country of countries" [value]="country">{{ country }}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Province</mat-label>
                      <mat-select formControlName="province">
                        <mat-option *ngFor="let province of provinces" [value]="province">{{ province }}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Postal Code</mat-label>
                      <input matInput type="text" formControlName="postalCode" />
                      <mat-error *ngIf="physicalAddress.controls['postalCode'].hasError('pattern')">
                        Postal code must contain only numbers.
                      </mat-error>
                    </mat-form-field>
                    <form [formGroup]="postalAddressForm" class="col-lg-7 col-md-12">
                      <mat-checkbox formControlName="sameAsPhysicalAddress" (change)="postalSameAsPhysicalAddress()">Postal address is the same as physical address</mat-checkbox>
                    </form>
                  </form>
                  <form [formGroup]="postalAddress" *ngIf="!postalAddressForm.controls['sameAsPhysicalAddress'].value" class="row flex-column justify-content-center align-items-center roboto-font col-md-12 mt-5">
                    <h1 class="col-lg-7 col-md-12 fs-1">Postal Address</h1>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Unit Number</mat-label>
                      <input matInput type="text" formControlName="unitNumber" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Complex Name</mat-label>
                      <input matInput type="text" formControlName="complexName" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>City/Town</mat-label>
                      <input matInput type="text" formControlName="city" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Suburb/District</mat-label>
                      <input matInput type="text" formControlName="suburbDistrict" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Street Number</mat-label>
                      <input matInput type="text" formControlName="streetNumber" />
                      <mat-error *ngIf="postalAddress.controls['streetNumber'].hasError('pattern')">
                        Street Number must contain only numbers.
                      </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Country</mat-label>
                      <mat-select formControlName="country">
                        <mat-option *ngFor="let country of countries" [value]="country">{{ country }}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Province</mat-label>
                      <mat-select formControlName="province">
                        <mat-option *ngFor="let province of provinces" [value]="province">{{ province }}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="col-lg-7 col-md-12 mt-2">
                      <mat-label>Postal Code</mat-label>
                      <input matInput type="text" formControlName="postalCode" />
                      <mat-error *ngIf="postalAddress.controls['postalCode'].hasError('pattern')">
                        Postal code must contain only numbers.
                      </mat-error>
                    </mat-form-field>
                  </form>
                </div>
              </div>
          <div id="footer">
            <button id="cancel-button" (click)="goToPreviousPage()">Cancel</button>
            <button id="next-button" matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="uploadDocumentForm" label="Upload Documents">
        <ng-template matStepLabel>Upload Documents</ng-template>
        <form [formGroup]="uploadDocumentForm">
          <button id="back" matStepperPrevious>ðŸ¡¨ Back</button>
            <div class="row justify-content-center align-items-center">
              <div class="col-md-12 col-lg-12">
                <h2 class="text-center" id="createEmployee">Start Kit Documents</h2>
                <span class="text-center roboto-font" id="heading-text">
                  <p>Please upload employeeâ€™s starter kit documents below</p>
                </span>
              </div>
            </div>
            <div class="container upload-drop-container">
              <div class="row justify-content-center align-items-center">
                    <div class="upload-drop-section row">
                      <ngx-file-drop
                      dropZoneClassName="upload-drop-section"
                      contentClassName=""
                      accept=".PDF,.PPT.PPTX,.Doc,.Docx"
                      (onFileDrop)="dropped($event, 0)"
                      (onFileOver)="fileOver($event)"
                      (onFileLeave)="fileLeave($event)">
                        <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector" directory="true" multiple="true">
                      <div class="justify-content-center align-items-center p-2 m-2">
                          <div id="align">
                            <mat-icon id="icon">check_circle</mat-icon>
                          </div>
                          <div class="roboto-font col-6" *ngIf="categories[0].state == true" id="align">
                            <p id="title">Fixed-term contract</p>
                            <p id="supported">PDF,PPT,PPTX,Doc,Docx are supported</p>
                          </div>
                          <div class="roboto-font col-7" *ngIf="categories[0].state == false" id="align">
                            <p id="title">Fixed-term contract</p>
                            <p id="document-text">{{categories[0].name}}</p>
                          </div>
                          <div class="file-mention col-3" id="align" *ngIf="categories[0].state == true">
                            <p id="drop-file">Drop your files here!</p>
                          </div>
                          <div id="align">
                            <button id="file-button" *ngIf="categories[0].state == false" class="mx-2" type="button" (click)="removeByCategory(0)">âœ– Remove</button>
                            <button id="upload-button" class="text-white border-primary mx-2" type="button" (click)="openFileSelector()" [disabled]="categories[0].state == false"> + Upload</button>
                          </div>
                      </div>
                      </ng-template>
                      </ngx-file-drop>
                    </div>
                    <div class="upload-drop-section row">
                      <ngx-file-drop
                      dropZoneClassName="upload-drop-section"
                      contentClassName=""
                      accept=".PDF,.PPT.PPTX,.Doc,.Docx"
                      (onFileDrop)="dropped($event, 1)"
                      (onFileOver)="fileOver($event)"
                      (onFileLeave)="fileLeave($event)">
                        <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector" directory="true" multiple="true">
                      <div class="justify-content-center align-items-center p-2 m-2">
                        <div id="align">
                          <mat-icon id="icon">check_circle</mat-icon>
                        </div>
                        <div class="roboto-font col-6" *ngIf="categories[1].state == true" id="align">
                          <p id="title">Retirement Annuity</p>
                          <p id="supported">PDF,PPT,PPTX,Doc,Docx are supported</p>
                        </div>
                        <div class="roboto-font col-7" *ngIf="categories[1].state == false" id="align">
                          <p id="title">Retirement Annuity</p>
                          <p id="document-text">{{categories[1].name}}</p>
                        </div>
                        <div class="file-mention col-3" id="align" *ngIf="categories[1].state == true">
                          <p id="drop-file">Drop your files here!</p>
                        </div>
                        <div id="align">
                          <button id="file-button" *ngIf="categories[1].state == false" class="mx-2" type="button" (click)="removeByCategory(1)">âœ– Remove</button>
                          <button id="upload-button" class="text-white border-primary mx-2" type="button" (click)="openFileSelector()" [disabled]="categories[1].state == false"> + Upload</button>
                        </div>
                      </div>
                        </ng-template>
                      </ngx-file-drop>
                    </div>
                    <div class="upload-drop-section row">
                      <ngx-file-drop
                      dropZoneClassName="upload-drop-section"
                      contentClassName=""
                      accept=".PDF,.PPT.PPTX,.Doc,.Docx"
                      (onFileDrop)="dropped($event, 2)"
                      (onFileOver)="fileOver($event)"
                      (onFileLeave)="fileLeave($event)">
                        <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector" directory="true" multiple="true">
                      <div class="justify-content-center align-items-center p-2 m-2">
                        <div id="align">
                          <mat-icon id="icon">check_circle</mat-icon>
                        </div>
                        <div class="roboto-font col-6" *ngIf="categories[2].state == true" id="align">
                          <p id="title">Retirement Annuity</p>
                          <p id="supported">PDF,PPT,PPTX,Doc,Docx are supported</p>
                        </div>
                        <div class="roboto-font col-7" *ngIf="categories[2].state == false" id="align">
                          <p id="title">Retirement Annuity</p>
                          <p id="document-text">{{categories[2].name}}</p>
                        </div>
                        <div class="file-mention col-3" id="align" *ngIf="categories[2].state == true">
                          <p id="drop-file">Drop your files here!</p>
                        </div>
                        <div id="align">
                          <button id="file-button" *ngIf="categories[2].state == false" class="mx-2" type="button" (click)="removeByCategory(2)">âœ– Remove</button>
                          <button id="upload-button" class="text-white border-primary mx-2" type="button" (click)="openFileSelector()" [disabled]="categories[1].state == false"> + Upload</button>
                        </div>
                      </div>
                        </ng-template>
                      </ngx-file-drop>
                    </div>
                    <div class="upload-drop-mie row">
                      <ngx-file-drop
                      dropZoneClassName="upload-drop-section"
                      contentClassName=""
                      accept=".PDF,.PPT.PPTX,.Doc,.Docx"
                      (onFileDrop)="dropped($event, 3)"
                      (onFileOver)="fileOver($event)"
                      (onFileLeave)="fileLeave($event)">
                        <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector" directory="true" multiple="true">
                      <div class="justify-content-center align-items-center p-2 m-2">
                        <div class="roboto-font col-6" id="align" *ngIf="categories[3].state == true">
                          <p id="title">MIE Consent Form</p>
                          <p id="supported">PDF,PPT,PPTX,Doc,Docx are supported</p>
                        </div>
                        <div class="roboto-font col-7" id="align-mie-two" *ngIf="categories[3].state == false" >
                          <p id="title">MIE Consent Form</p>
                          <p id="document-text">{{categories[3].name}}</p>
                        </div>
                        <div class="col-3" id="align-mie" *ngIf="categories[3].state == true">
                          <p id="drop-file">Drop your files here!</p>
                        </div>
                        <div id="align">
                          <button id="file-button" *ngIf="categories[3].state == false" class="mx-2" type="button" (click)="removeByCategory(3)">âœ– Remove</button>
                          <button id="upload-button" class="text-white border-primary mx-2" type="button" (click)="openFileSelector()" [disabled]="categories[3].state == false"> + Upload</button>
                        </div>
                      </div>
                        </ng-template>
                      </ngx-file-drop>
                    </div>
              </div>
            </div>
          <div id="footer">
            <button id="cancel-button" (click)="goToPreviousPage()">Cancel</button>
            <button id="save-add-button" (click)="saveAndAddAnother()">Save and add another</button>
            <button id="save-button" (click)="saveAndExit()">Save</button>
          </div>
        </form>
      </mat-step>
    </mat-stepper>
  </div>
